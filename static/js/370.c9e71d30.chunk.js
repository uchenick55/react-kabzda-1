"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[370,853],{9563:function(e,s,t){t.r(s),t.d(s,{default:function(){return Te}});var a=t(5671),o=t(3144),r=t(136),i=t(7277),n=t(2791),l=t(8281),d=t(8687),c=t(7781),u=t(1852),g="UserListMessages_usersListMessagesFixed__n95Kp",p="UserListMessages_setDesktop__mYjrO",m="UserListMessages_setMobile__RZGLB",h="UserListMessages_usersListCommonFixed__lwndY",f="UserListMessages_MessagesCommonFixed__T4G57",v="UserListMessages_userPhoto__iRPSv",M="UserListMessages_messagesHeaderFixed__v6Hxk",x="UserListMessages_messagesMiddleFixed__MWdHU",_="UserListMessages_messagesFooterFixed__kCMoI",y="UserListMessages_myLink__-Xnne",I=t(6110),j="Message_messagesCommon__WS2pF",L="Message_messageMyId__+mbtn",C="Message_messageNotMyId__5+CvR",D="Message_insideToastMy__P6sDI",T="Message_insideToastNotMy__meNqg",k="Message_time__4GQ5r",Z="Message_closeButton__OGOB3",b="Message_placeholder__SqINF",N=t(1413),U=t(5987),P=t(1694),w=t.n(P),B=t(5746),F=t(1683),H=Math.pow(2,31)-1;function R(e,s,t){var a=t-Date.now();e.current=a<=H?setTimeout(s,a):setTimeout((function(){return R(e,s,t)}),H)}function E(){var e=(0,B.Z)(),s=(0,n.useRef)();return(0,F.Z)((function(){return clearTimeout(s.current)})),(0,n.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(a,o){void 0===o&&(o=0),e()&&(t(),o<=H?s.current=setTimeout(a,o):R(s,a,Date.now()+o))},clear:t}}),[])}var W,O=t(4942),S=t(5090),q=t(2709),G=t(184),V=(W={},(0,O.Z)(W,S.d0,"showing"),(0,O.Z)(W,S.Ix,"showing show"),W),A=n.forwardRef((function(e,s){return(0,G.jsx)(q.Z,(0,N.Z)((0,N.Z)({},e),{},{ref:s,transitionClasses:V}))}));A.displayName="ToastFade";var J=A,Y=t(9007),$=t(162),K=t(473),Q=n.createContext({onClose:function(){}}),X=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],z=n.forwardRef((function(e,s){var t=e.bsPrefix,a=e.closeLabel,o=e.closeVariant,r=e.closeButton,i=e.className,l=e.children,d=(0,U.Z)(e,X);t=(0,$.vE)(t,"toast-header");var c=(0,n.useContext)(Q),u=(0,Y.Z)((function(e){null==c||null==c.onClose||c.onClose(e)}));return(0,G.jsxs)("div",(0,N.Z)((0,N.Z)({ref:s},d),{},{className:w()(t,i),children:[l,r&&(0,G.jsx)(K.Z,{"aria-label":a,variant:o,onClick:u,"data-dismiss":"toast"})]}))}));z.displayName="ToastHeader",z.defaultProps={closeLabel:"Close",closeButton:!0};var ee=z,se=(0,t(6543).Z)("toast-body"),te=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],ae=n.forwardRef((function(e,s){var t=e.bsPrefix,a=e.className,o=e.transition,r=void 0===o?J:o,i=e.show,l=void 0===i||i,d=e.animation,c=void 0===d||d,u=e.delay,g=void 0===u?5e3:u,p=e.autohide,m=void 0!==p&&p,h=e.onClose,f=e.bg,v=(0,U.Z)(e,te);t=(0,$.vE)(t,"toast");var M=(0,n.useRef)(g),x=(0,n.useRef)(h);(0,n.useEffect)((function(){M.current=g,x.current=h}),[g,h]);var _=E(),y=!(!m||!l),I=(0,n.useCallback)((function(){y&&(null==x.current||x.current())}),[y]);(0,n.useEffect)((function(){_.set(I,M.current)}),[_,I]);var j=(0,n.useMemo)((function(){return{onClose:h}}),[h]),L=!(!r||!c),C=(0,G.jsx)("div",(0,N.Z)((0,N.Z)({},v),{},{ref:s,className:w()(t,a,f&&"bg-".concat(f),!L&&(l?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,G.jsx)(Q.Provider,{value:j,children:L&&r?(0,G.jsx)(r,{in:l,unmountOnExit:!0,children:C}):C})}));ae.displayName="Toast";var oe=Object.assign(ae,{Body:se,Header:ee}),re=function(e){var s=e.message,t=e.myId,a=e.userId,o=e.Date,r=e.MessageId,i=e.deleteMessage;return(0,G.jsx)("div",{children:(0,G.jsx)("div",{className:"".concat(j," ").concat(t===a?L:C),children:(0,G.jsx)(oe,{className:t===a?D:T,children:(0,G.jsx)(oe.Body,{children:(0,G.jsxs)("div",{className:"d-flex d-inline-block",children:[" ",(0,G.jsxs)("big",{children:[s," "]}),(0,G.jsxs)("div",{className:k,children:[("0"+o.Hour).substr(-2),":",("0"+o.Minutes).substr(-2)]}),(0,G.jsx)("div",{className:b})," ",(0,G.jsx)(K.Z,{className:Z,onClick:function(){i(r)}})]})})})})})},ie=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage;return(0,G.jsx)("div",{children:null!==s&&s.map((function(e){return(0,G.jsx)(re,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:a},e.id+e.message)}))})},ne=t(5705),le=t(1724),de=t(6670),ce=t(3360),ue=t(2592);var ge=t.p+"static/media/send-svg2.12d8e771d6d27bcd4485de69966afd04.svg",pe="MessagesFormik_sendSwg__bjMJ-",me={newMessage:""},he=le.Ry({}),fe=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(ne.J9,{initialValues:me,validationSchema:he,onSubmit:function(e,t){var a=t.resetForm;s(e.newMessage),a()},children:function(e){e.handleReset;var s=e.values;return(0,G.jsx)(ne.l0,{children:(0,G.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,G.jsx)("div",{className:"col-9",children:(0,G.jsx)(de.rZ,{label:"",autoFocus:!0,name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",leftLabelLength:""})}),(0,G.jsx)("div",{children:(0,G.jsx)(ce.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,G.jsx)(ue.Z,{src:ge,className:pe,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},ve=t(1087),Me=t(8517),xe=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage,o=e.sendMessage,r=e.scrollBottom,i=e.profile,n=e.patch,l=e.PageWidth,d=(0,G.jsx)("div",{children:i&&(0,G.jsxs)(ve.OL,{to:"/profile/".concat(i.userId),className:y,children:[(0,G.jsx)(ue.Z,{src:i.photos.small?i.photos.small:I,className:v,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,G.jsx)("span",{children:i.fullName})]})}),c="dialogs"===n&&l<620;return(0,G.jsxs)("div",{className:"".concat(g," ").concat(c?m:p),children:[!c&&(0,G.jsx)("div",{className:h,children:(0,G.jsx)(Me.default,{})})," ",(0,G.jsxs)("div",{className:f,children:[(0,G.jsx)("div",{className:M,children:d}),(0,G.jsxs)("div",{className:x,children:[(0,G.jsx)(ie,{messages2:s,myId:t,deleteMessage:a}),(0,G.jsx)("div",{className:_,children:(0,G.jsx)(fe,{sendMessage:o,scrollBottom:r})})]})]})]})},_e=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},ye=function(e){(0,r.Z)(t,e);var s=(0,i.Z)(t);function t(){var e;(0,a.Z)(this,t);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).sendMessage=function(s){if(e.props.userId){if(s){var t=e.props.profile?e.props.profile.fullName:"",a=e.props.profile?e.props.profile.photos.small:"",o=e.props.myProfile?e.props.myProfile.photos.small:"";e.props.sendDialogsThunkCreator(s,e.props.myId,e.props.myLogin,o,e.props.userId),e.props.updateDialogListThunkCreator(e.props.myId,e.props.userId,t,a)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){_e()},e}return(0,o.Z)(t,[{key:"render",value:function(){return(0,G.jsx)("div",{children:(0,G.jsx)(xe,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profile:this.props.profile,patch:this.props.patch,PageWidth:this.props.PageWidth})})}}]),t}(n.Component),Ie=(0,c.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,myLogin:e.auth.myLogin,myProfile:e.auth.myProfile,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profile:e.profilePage.profile,profilePage:e.profilePage,patch:e.app.patch,PageWidth:e.app.PageWidth}}),{sendDialogsThunkCreator:l.nB,deleteMessageThunkCreator:l.EF,updateDialogListThunkCreator:l.wB}),u.Z)(ye),je=function(e){var s=e.getDialogList,t=e.getDialogLastUpdateTime;return(0,n.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,G.jsx)(Ie,{})},Le=t(81),Ce=t(3990),De=function(e){(0,r.Z)(t,e);var s=(0,i.Z)(t);function t(){var e;(0,a.Z)(this,t);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2&&e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(0))},e.getDialogs=function(){0!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){0!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,G.jsx)("div",{children:(0,G.jsx)(je,{getDialogLastUpdateTime:this.getDialogLastUpdateTime,getDialogList:this.getDialogList})})}}]),t}(n.Component),Te=(0,c.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime}}),{getDialogsThunkCreator:l.kp,setdialogUserID:l.Pg,setMessages:l.Z,getDialogLastUpdateTimeTnkCrt:l.kB,getProfileThunkCreator:Le.aI,getMyDialogListThunkCreator:l.l,deleteDialogThunkCreator:l.LZ}),u.Z,Ce.Z)(De)}}]);
//# sourceMappingURL=370.c9e71d30.chunk.js.map