"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[370,853],{9563:function(e,s,t){t.r(s),t.d(s,{default:function(){return De}});var a=t(5671),o=t(3144),r=t(136),n=t(7277),i=t(2791),l=t(8281),d=t(8687),c=t(7781),u=t(1852),g="UserListMessages_usersListMessagesFixed__n95Kp",p="UserListMessages_usersListCommonFixed__lwndY",m="UserListMessages_MessagesCommonFixed__T4G57",f="UserListMessages_userPhoto__iRPSv",h="UserListMessages_messagesHeaderFixed__v6Hxk",v="UserListMessages_messagesMiddleFixed__MWdHU",x="UserListMessages_messagesFooterFixed__kCMoI",M="UserListMessages_myLink__-Xnne",y=t(6110),I="Message_messagesCommon__WS2pF",_="Message_messageMyId__+mbtn",j="Message_messageNotMyId__5+CvR",C="Message_insideToastMy__P6sDI",D="Message_insideToastNotMy__meNqg",L="Message_time__4GQ5r",T="Message_closeButton__OGOB3",k="Message_placeholder__SqINF",Z=t(1413),N=t(5987),b=t(1694),U=t.n(b),P=t(5746),w=t(1683),B=Math.pow(2,31)-1;function F(e,s,t){var a=t-Date.now();e.current=a<=B?setTimeout(s,a):setTimeout((function(){return F(e,s,t)}),B)}function H(){var e=(0,P.Z)(),s=(0,i.useRef)();return(0,w.Z)((function(){return clearTimeout(s.current)})),(0,i.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(a,o){void 0===o&&(o=0),e()&&(t(),o<=B?s.current=setTimeout(a,o):F(s,a,Date.now()+o))},clear:t}}),[])}var E,R=t(4942),S=t(5090),O=t(2709),q=t(184),G=(E={},(0,R.Z)(E,S.d0,"showing"),(0,R.Z)(E,S.Ix,"showing show"),E),V=i.forwardRef((function(e,s){return(0,q.jsx)(O.Z,(0,Z.Z)((0,Z.Z)({},e),{},{ref:s,transitionClasses:G}))}));V.displayName="ToastFade";var A=V,J=t(9007),W=t(162),$=t(473),K=i.createContext({onClose:function(){}}),Q=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],X=i.forwardRef((function(e,s){var t=e.bsPrefix,a=e.closeLabel,o=e.closeVariant,r=e.closeButton,n=e.className,l=e.children,d=(0,N.Z)(e,Q);t=(0,W.vE)(t,"toast-header");var c=(0,i.useContext)(K),u=(0,J.Z)((function(e){null==c||null==c.onClose||c.onClose(e)}));return(0,q.jsxs)("div",(0,Z.Z)((0,Z.Z)({ref:s},d),{},{className:U()(t,n),children:[l,r&&(0,q.jsx)($.Z,{"aria-label":a,variant:o,onClick:u,"data-dismiss":"toast"})]}))}));X.displayName="ToastHeader",X.defaultProps={closeLabel:"Close",closeButton:!0};var Y=X,z=(0,t(6543).Z)("toast-body"),ee=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],se=i.forwardRef((function(e,s){var t=e.bsPrefix,a=e.className,o=e.transition,r=void 0===o?A:o,n=e.show,l=void 0===n||n,d=e.animation,c=void 0===d||d,u=e.delay,g=void 0===u?5e3:u,p=e.autohide,m=void 0!==p&&p,f=e.onClose,h=e.bg,v=(0,N.Z)(e,ee);t=(0,W.vE)(t,"toast");var x=(0,i.useRef)(g),M=(0,i.useRef)(f);(0,i.useEffect)((function(){x.current=g,M.current=f}),[g,f]);var y=H(),I=!(!m||!l),_=(0,i.useCallback)((function(){I&&(null==M.current||M.current())}),[I]);(0,i.useEffect)((function(){y.set(_,x.current)}),[y,_]);var j=(0,i.useMemo)((function(){return{onClose:f}}),[f]),C=!(!r||!c),D=(0,q.jsx)("div",(0,Z.Z)((0,Z.Z)({},v),{},{ref:s,className:U()(t,a,h&&"bg-".concat(h),!C&&(l?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,q.jsx)(K.Provider,{value:j,children:C&&r?(0,q.jsx)(r,{in:l,unmountOnExit:!0,children:D}):D})}));se.displayName="Toast";var te=Object.assign(se,{Body:z,Header:Y}),ae=function(e){var s=e.message,t=e.myId,a=e.userId,o=e.Date,r=e.MessageId,n=e.deleteMessage;return(0,q.jsx)("div",{children:(0,q.jsx)("div",{className:"".concat(I," ").concat(t===a?_:j),children:(0,q.jsx)(te,{className:t===a?C:D,children:(0,q.jsx)(te.Body,{children:(0,q.jsxs)("div",{className:"d-flex d-inline-block",children:[" ",(0,q.jsxs)("big",{children:[s," "]}),(0,q.jsxs)("div",{className:L,children:[("0"+o.Hour).substr(-2),":",("0"+o.Minutes).substr(-2)]}),(0,q.jsx)("div",{className:k})," ",(0,q.jsx)($.Z,{className:T,onClick:function(){n(r)}})]})})})})})},oe=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage;return(0,q.jsx)("div",{children:null!==s&&s.map((function(e){return(0,q.jsx)(ae,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:a},e.id+e.message)}))})},re=t(5705),ne=t(1724),ie=t(6670),le=t(3360),de=t(2592);var ce=t.p+"static/media/send-svg2.12d8e771d6d27bcd4485de69966afd04.svg",ue="MessagesFormik_sendSwg__bjMJ-",ge={newMessage:""},pe=ne.Ry({}),me=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,q.jsx)(q.Fragment,{children:(0,q.jsx)(re.J9,{initialValues:ge,validationSchema:pe,onSubmit:function(e,t){var a=t.resetForm;s(e.newMessage),a()},children:function(e){e.handleReset;var s=e.values;return(0,q.jsx)(re.l0,{children:(0,q.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,q.jsx)("div",{className:"col-9",children:(0,q.jsx)(ie.rZ,{label:"",autoFocus:!0,name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",leftLabelLength:""})}),(0,q.jsx)("div",{children:(0,q.jsx)(le.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,q.jsx)(de.Z,{src:ce,className:ue,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},fe=t(1087),he=t(8517),ve=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage,o=e.sendMessage,r=e.scrollBottom,n=e.profile,i=(0,q.jsx)("div",{children:n&&(0,q.jsxs)(fe.OL,{to:"/profile/".concat(n.userId),className:M,children:[(0,q.jsx)(de.Z,{src:n.photos.small?n.photos.small:y,className:f,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,q.jsx)("span",{children:n.fullName})]})});return(0,q.jsxs)("div",{className:g,children:[(0,q.jsx)("div",{className:p,children:(0,q.jsx)(he.default,{})}),(0,q.jsxs)("div",{className:m,children:[(0,q.jsx)("div",{className:h,children:i}),(0,q.jsxs)("div",{className:v,children:[(0,q.jsx)(oe,{messages2:s,myId:t,deleteMessage:a}),(0,q.jsx)("div",{className:x,children:(0,q.jsx)(me,{sendMessage:o,scrollBottom:r})})]})]})]})},xe=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},Me=function(e){(0,r.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,a.Z)(this,t);for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=s.call.apply(s,[this].concat(r))).sendMessage=function(s){if(e.props.userId){if(s){e.props.profile;var t=e.props.profile?e.props.profile.fullName:"",a=e.props.profile?e.props.profile.photos.small:"",o=e.props.myProfile?e.props.myProfile.photos.small:"";e.props.sendDialogsThunkCreator(s,e.props.myId,e.props.myLogin,o,e.props.userId),e.props.updateDialogListThunkCreator(e.props.myId,e.props.userId,t,a)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){xe()},e}return(0,o.Z)(t,[{key:"render",value:function(){return(0,q.jsx)("div",{children:(0,q.jsx)(ve,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profile:this.props.profile})})}}]),t}(i.Component),ye=(0,c.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,myLogin:e.auth.myLogin,myProfile:e.auth.myProfile,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profile:e.profilePage.profile,profilePage:e.profilePage}}),{sendDialogsThunkCreator:l.nB,deleteMessageThunkCreator:l.EF,updateDialogListThunkCreator:l.wB}),u.Z)(Me),Ie=function(e){var s=e.getDialogList,t=e.getDialogLastUpdateTime;return(0,i.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,q.jsx)(ye,{})},_e=t(81),je=t(3990),Ce=function(e){(0,r.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,a.Z)(this,t);for(var o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=s.call.apply(s,[this].concat(r))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2&&e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(0))},e.getDialogs=function(){0!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){0!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,q.jsx)("div",{children:(0,q.jsx)(Ie,{getDialogLastUpdateTime:this.getDialogLastUpdateTime,getDialogList:this.getDialogList})})}}]),t}(i.Component),De=(0,c.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime}}),{getDialogsThunkCreator:l.kp,setdialogUserID:l.Pg,setMessages:l.Z,getDialogLastUpdateTimeTnkCrt:l.kB,getProfileThunkCreator:_e.aI,getMyDialogListThunkCreator:l.l,deleteDialogThunkCreator:l.LZ}),u.Z,je.Z)(Ce)}}]);
//# sourceMappingURL=370.33a82e37.chunk.js.map