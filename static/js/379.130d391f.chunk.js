"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[379],{7187:function(e,s,t){t.r(s),t.d(s,{default:function(){return Fe}});var r=t(5671),n=t(3144),a=t(136),o=t(7277),i=t(2791),l=t(8281),u=t(8687),c=t(7781),d=t(1852),p="UserListMessages_usersListMessagesFixed__n95Kp",g="UserListMessages_setDesktop__mYjrO",h="UserListMessages_setMobile__RZGLB",m="UserListMessages_usersListCommonFixed__lwndY",f="UserListMessages_MessagesCommonFixed__T4G57",v="UserListMessages_userPhoto__iRPSv",x="UserListMessages_messagesHeaderFixed__v6Hxk",y="UserListMessages_messagesMiddleFixed__MWdHU",C="UserListMessages_messagesFooterFixed__kCMoI",I="UserListMessages_myLink__-Xnne",T=t(6110),j="Message_messagesCommon__WS2pF",_="Message_messageMyId__+mbtn",M="Message_messageNotMyId__5+CvR",Z="Message_insideToastMy__P6sDI",P="Message_insideToastNotMy__meNqg",L="Message_time__4GQ5r",k="Message_closeButton__OGOB3",b="Message_placeholder__SqINF",U=t(1413),F=t(5987),D=t(1694),w=t.n(D),N=t(5746),S=t(1683),A=Math.pow(2,31)-1;function R(e,s,t){var r=t-Date.now();e.current=r<=A?setTimeout(s,r):setTimeout((function(){return R(e,s,t)}),A)}function O(){var e=(0,N.Z)(),s=(0,i.useRef)();return(0,S.Z)((function(){return clearTimeout(s.current)})),(0,i.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(r,n){void 0===n&&(n=0),e()&&(t(),n<=A?s.current=setTimeout(r,n):R(s,r,Date.now()+n))},clear:t}}),[])}var B,W=t(4942),H=t(5090),z=t(2709),E=t(184),$=(B={},(0,W.Z)(B,H.d0,"showing"),(0,W.Z)(B,H.Ix,"showing show"),B),q=i.forwardRef((function(e,s){return(0,E.jsx)(z.Z,(0,U.Z)((0,U.Z)({},e),{},{ref:s,transitionClasses:$}))}));q.displayName="ToastFade";var G=q,V=t(9007),J=t(162),Y=t(473),K=i.createContext({onClose:function(){}}),Q=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],X=i.forwardRef((function(e,s){var t=e.bsPrefix,r=e.closeLabel,n=e.closeVariant,a=e.closeButton,o=e.className,l=e.children,u=(0,F.Z)(e,Q);t=(0,J.vE)(t,"toast-header");var c=(0,i.useContext)(K),d=(0,V.Z)((function(e){null==c||null==c.onClose||c.onClose(e)}));return(0,E.jsxs)("div",(0,U.Z)((0,U.Z)({ref:s},u),{},{className:w()(t,o),children:[l,a&&(0,E.jsx)(Y.Z,{"aria-label":r,variant:n,onClick:d,"data-dismiss":"toast"})]}))}));X.displayName="ToastHeader",X.defaultProps={closeLabel:"Close",closeButton:!0};var ee=X,se=(0,t(6543).Z)("toast-body"),te=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],re=i.forwardRef((function(e,s){var t=e.bsPrefix,r=e.className,n=e.transition,a=void 0===n?G:n,o=e.show,l=void 0===o||o,u=e.animation,c=void 0===u||u,d=e.delay,p=void 0===d?5e3:d,g=e.autohide,h=void 0!==g&&g,m=e.onClose,f=e.bg,v=(0,F.Z)(e,te);t=(0,J.vE)(t,"toast");var x=(0,i.useRef)(p),y=(0,i.useRef)(m);(0,i.useEffect)((function(){x.current=p,y.current=m}),[p,m]);var C=O(),I=!(!h||!l),T=(0,i.useCallback)((function(){I&&(null==y.current||y.current())}),[I]);(0,i.useEffect)((function(){C.set(T,x.current)}),[C,T]);var j=(0,i.useMemo)((function(){return{onClose:m}}),[m]),_=!(!a||!c),M=(0,E.jsx)("div",(0,U.Z)((0,U.Z)({},v),{},{ref:s,className:w()(t,r,f&&"bg-".concat(f),!_&&(l?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,E.jsx)(K.Provider,{value:j,children:_&&a?(0,E.jsx)(a,{in:l,unmountOnExit:!0,children:M}):M})}));re.displayName="Toast";var ne=Object.assign(re,{Body:se,Header:ee}),ae=function(e){var s=e.message,t=e.myId,r=e.userId,n=e.Date,a=e.MessageId,o=e.deleteMessage;return(0,E.jsx)("div",{children:(0,E.jsx)("div",{className:"".concat(j," ").concat(t===r?_:M),children:(0,E.jsx)(ne,{className:t===r?Z:P,children:(0,E.jsx)(ne.Body,{children:(0,E.jsxs)("div",{className:"d-flex d-inline-block",children:[" ",(0,E.jsxs)("big",{children:[s," "]}),(0,E.jsxs)("div",{className:L,children:[("0"+n.Hour).substr(-2),":",("0"+n.Minutes).substr(-2)]}),(0,E.jsx)("div",{className:b})," ",(0,E.jsx)(Y.Z,{className:k,onClick:function(){o(a)}})]})})})})})},oe=function(e){var s=e.messages2,t=e.myId,r=e.deleteMessage;return(0,E.jsx)("div",{children:null!==s&&s.map((function(e){return(0,E.jsx)(ae,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:r},e.id+e.message)}))})},ie=t(5705),le=t(1724),ue=t(6670),ce=t(3360),de=t(2592);var pe=t.p+"static/media/send-svg2.12d8e771d6d27bcd4485de69966afd04.svg",ge="MessagesFormik_sendSwg__bjMJ-",he={newMessage:""},me=le.Ry({}),fe=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(ie.J9,{initialValues:he,validationSchema:me,onSubmit:function(e,t){var r=t.resetForm;s(e.newMessage),r()},children:function(e){e.handleReset;var s=e.values;return(0,E.jsx)(ie.l0,{children:(0,E.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,E.jsx)("div",{className:"col-9",children:(0,E.jsx)(ue.rZ,{label:"",autoFocus:!0,name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",leftLabelLength:""})}),(0,E.jsx)("div",{children:(0,E.jsx)(ce.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,E.jsx)(de.Z,{src:pe,className:ge,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},ve=t(1087),xe=t(5732),ye=t(4199),Ce=t(6159),Ie=t(1394),Te=function(e){(0,a.Z)(t,e);var s=(0,o.Z)(t);function t(e){var n;return(0,r.Z)(this,t),(n=s.call(this,e)).onChangeTermFunction=function(e){n.setState({onChangeTerm:e.currentTarget.value})},n.onChangeRangeLocal=function(e){n.setState({currentRangeLocal:n.state.currentRangeLocal+e})},n.SetTermFunction=function(){n.props.setTerm(n.state.onChangeTerm)},n.onPageChanged=function(e){var s=n.props,t=s.setCurrentPage,r=s.getUsersThunkCreator,a=s.pageSize,o=s.term,i=s.onlyFriends;t(e),r(e,a,o,i,0)},n.followAPI=function(e){n.props.followThunkCreator(e,n.props.currentPage,n.props.pageSize,n.props.term,n.props.onlyFriends)},n.unfollowAPI=function(e){n.props.unfollowThunkCreator(e,n.props.currentPage,n.props.pageSize,n.props.term,n.props.onlyFriends)},n.state={onChangeTerm:n.props.term,currentRangeLocal:1},n}return(0,n.Z)(t,[{key:"componentDidMount",value:function(){var e=this.props;(0,e.getUsersThunkCreator)(e.currentPage,e.pageSize,e.term,e.onlyFriends,0)}},{key:"componentDidUpdate",value:function(e,s){if(e.term!==this.props.term||e.onlyFriends!==this.props.onlyFriends){this.props.setCurrentPage(1),this.setState({currentRangeLocal:1});var t=this.props;(0,t.getUsersThunkCreator)(1,t.pageSize,t.term,t.onlyFriends,0)}}},{key:"render",value:function(){var e=this.props,s=e.isFetching,t=e.totalUsersCount,r=e.pageSize,n=e.currentPage,a=e.users,o=e.followingInProgress,i=e.isAuth;return(0,E.jsxs)(E.Fragment,{children:[" ",s&&(0,E.jsx)(Ce.Z,{}),(0,E.jsx)(ye.Z,{onPageChanged:this.onPageChanged,totalUsersCount:t,pageSize:r,currentPage:n,users:a,unfollowAPI:this.unfollowAPI,followAPI:this.followAPI,followingInProgress:o,isAuth:i,SetTermFunction:this.SetTermFunction,onChangeTerm:this.state.onChangeTerm,onChangeTermFunction:this.onChangeTermFunction,currentRangeLocal:this.state.currentRangeLocal,onChangeRangeLocal:this.onChangeRangeLocal,setOnlyFriends:this.props.setOnlyFriends,onlyFriends:this.props.onlyFriends,patch:this.props.patch,PageWidth:this.props.PageWidth})]})}}]),t}(i.Component),je=(0,u.$j)((function(e){return{users:(0,Ie.x)(e),pageSize:Ie.O.getPageSize(e),totalUsersCount:Ie.O.getTotalUsersCount(e),currentPage:Ie.O.getCurrentPage(e),isFetching:Ie.O.getIsFetching(e),followingInProgress:Ie.O.getFollowingInProgress(e),isAuth:Ie.O.getIsAuth(e),term:e.usersPage.term,myId:e.auth.myId,onlyFriends:Ie.O.getOnlyFriends(e),patch:e.app.patch,PageWidth:e.app.PageWidth}}),{setCurrentPage:xe.D4,getUsersThunkCreator:xe.Uk,followThunkCreator:xe.AC,unfollowThunkCreator:xe.Ow,setTerm:xe.nS,setOnlyFriends:xe.F3})(Te),_e=function(e){var s=e.messages2,t=e.myId,r=e.deleteMessage,n=e.sendMessage,a=e.scrollBottom,o=e.profile,i=e.patch,l=e.PageWidth,u=(0,E.jsx)("div",{children:o&&(0,E.jsxs)(ve.OL,{to:"/profile/".concat(o.userId),className:I,children:[(0,E.jsx)(de.Z,{src:o.photos.small?o.photos.small:T,className:v,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,E.jsx)("span",{children:o.fullName})]})}),c="dialogs"===i&&l<620;return(0,E.jsxs)("div",{className:"".concat(p," ").concat(c?h:g),children:[!c&&(0,E.jsx)("div",{className:m,children:(0,E.jsx)(je,{})})," ",(0,E.jsxs)("div",{className:f,children:[(0,E.jsx)("div",{className:x,children:u}),(0,E.jsxs)("div",{className:y,children:[(0,E.jsx)(oe,{messages2:s,myId:t,deleteMessage:r}),(0,E.jsx)("div",{className:C,children:(0,E.jsx)(fe,{sendMessage:n,scrollBottom:a})})]})]})]})},Me=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},Ze=function(e){(0,a.Z)(t,e);var s=(0,o.Z)(t);function t(){var e;(0,r.Z)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=s.call.apply(s,[this].concat(a))).sendMessage=function(s){if(e.props.userId){if(s){var t=e.props.profile?e.props.profile.fullName:"",r=e.props.profile?e.props.profile.photos.small:"",n=e.props.myProfile?e.props.myProfile.photos.small:"";e.props.sendDialogsThunkCreator(s,e.props.myId,e.props.myLogin,n,e.props.userId),e.props.updateDialogListThunkCreator(e.props.myId,e.props.userId,t,r)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){Me()},e}return(0,n.Z)(t,[{key:"render",value:function(){return(0,E.jsx)("div",{children:(0,E.jsx)(_e,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profile:this.props.profile,patch:this.props.patch,PageWidth:this.props.PageWidth})})}}]),t}(i.Component),Pe=(0,c.qC)((0,u.$j)((function(e){return{myId:e.auth.myId,myLogin:e.auth.myLogin,myProfile:e.auth.myProfile,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profile:e.profilePage.profile,profilePage:e.profilePage,patch:e.app.patch,PageWidth:e.app.PageWidth}}),{sendDialogsThunkCreator:l.nB,deleteMessageThunkCreator:l.EF,updateDialogListThunkCreator:l.wB}),d.Z)(Ze),Le=function(e){var s=e.getDialogList,t=e.getDialogLastUpdateTime;return(0,i.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,E.jsx)(Pe,{})},ke=t(81),be=t(3990),Ue=function(e){(0,a.Z)(t,e);var s=(0,o.Z)(t);function t(){var e;(0,r.Z)(this,t);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=s.call.apply(s,[this].concat(a))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2&&e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(0))},e.getDialogs=function(){0!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){0!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,n.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,E.jsx)("div",{children:(0,E.jsx)(Le,{getDialogLastUpdateTime:this.getDialogLastUpdateTime,getDialogList:this.getDialogList})})}}]),t}(i.Component),Fe=(0,c.qC)((0,u.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime}}),{getDialogsThunkCreator:l.kp,setdialogUserID:l.Pg,setMessages:l.Z,getDialogLastUpdateTimeTnkCrt:l.kB,getProfileThunkCreator:ke.aI,getMyDialogListThunkCreator:l.l,deleteDialogThunkCreator:l.LZ}),d.Z,be.Z)(Ue)},6670:function(e,s,t){t.d(s,{$m:function(){return f},rZ:function(){return m}});var r=t(1413),n=t(9439),a=t(5987),o=t(5705),i={errorInputTextArea:"formik1_errorInputTextArea__vpmAv",errorText:"formik1_errorText__eDWui",labelWidth:"formik1_labelWidth__cwal9"},l=(t(7632),t(9410)),u=t(5313),c=t(184),d=["label","children"],p=["label","autoFocus","type","leftLabelLength"],g=["children"],h=function(e){e.label;var s=e.children,t=(0,a.Z)(e,d),r=(0,o.U$)(t.props),l=(0,n.Z)(r,1)[0];return(0,c.jsxs)(c.Fragment,{children:[s," ",l.touched&&l.error&&(0,c.jsx)("div",{className:i.errorText,children:l.error})," "]})},m=function(e){var s=e.label,t=e.autoFocus,d=e.type,g=e.leftLabelLength,m=(0,a.Z)(e,p),f=(0,o.U$)(m),v=(0,n.Z)(f,2),x=v[0],y=v[1];return(0,c.jsxs)(h,{label:s,props:m,children:[" ",(0,c.jsxs)(l.Z,{className:"my-1",size:"sm",children:[" ",g&&(0,c.jsxs)(l.Z.Text,{id:s,className:i.labelWidth,style:{width:g},children:[s,":"]}),(0,c.jsx)(u.Z.Control,(0,r.Z)((0,r.Z)((0,r.Z)({as:"textarea"===d?d:"input",type:"password"===d?d:void 0,className:y.touched&&y.error?i.errorInputTextArea:i.inputTextArea},x),m),{},{autoFocus:t}))]}),(0,c.jsx)("div",{className:i.errorText,children:y.touched&&y.error})]})},f=function(e){var s=e.children,t=(0,a.Z)(e,g),l=(0,o.U$)((0,r.Z)((0,r.Z)({},t),{},{type:"checkbox"})),u=(0,n.Z)(l,2),d=u[0],p=u[1];return(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"checkbox-input",children:[(0,c.jsx)("input",(0,r.Z)((0,r.Z)({type:"checkbox"},d),t))," ",s]}),p.touched&&p.error&&(0,c.jsx)("div",{className:i.errorText,children:p.error})]})}},3990:function(e,s,t){var r=t(1413),n=(t(2791),t(8687)),a=t(7689),o=t(184),i=function(e){return{isAuth:e.auth.isAuth}};s.Z=function(e){return(0,n.$j)(i,null)((function(s){return s.isAuth?(0,o.jsx)(e,(0,r.Z)({},s)):(0,o.jsx)(a.Fg,{to:"../login"})}))}},1852:function(e,s,t){var r=t(1413),n=(t(2791),t(7689)),a=t(8687),o=t(184);s.Z=function(e){return(0,a.$j)(null,null)((function(s){var t={params:(0,n.UO)()},a=Number(t.params["*"]);return(0,o.jsx)(e,(0,r.Z)((0,r.Z)({},s),{},{userId:a}))}))}}}]);
//# sourceMappingURL=379.130d391f.chunk.js.map