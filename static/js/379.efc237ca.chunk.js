"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[379],{7187:function(e,s,t){t.r(s),t.d(s,{default:function(){return Ze}});var r=t(5671),a=t(3144),o=t(136),n=t(7277),i=t(2791),l=t(8281),d=t(8687),u=t(7781),c=t(1852),g="UserListMessages_usersListMessagesFixed__n95Kp",p="UserListMessages_setDesktop__mYjrO",m="UserListMessages_setMobile__RZGLB",h="UserListMessages_usersListCommonFixed__lwndY",f="UserListMessages_MessagesCommonFixed__T4G57",v="UserListMessages_userPhoto__iRPSv",y="UserListMessages_messagesHeaderFixed__v6Hxk",C="UserListMessages_messagesMiddleFixed__MWdHU",x="UserListMessages_messagesFooterFixed__kCMoI",I="UserListMessages_myLink__-Xnne",M=t(6110),P="Message_messagesCommon__WS2pF",T="Message_messageMyId__+mbtn",_="Message_messageNotMyId__5+CvR",j="Message_insideToastMy__P6sDI",L="Message_insideToastNotMy__meNqg",k="Message_time__4GQ5r",D="Message_closeButton__OGOB3",U="Message_placeholder__SqINF",F=t(1413),Z=t(5987),w=t(1694),b=t.n(w),N=t(5746),S=t(1683),R=Math.pow(2,31)-1;function O(e,s,t){var r=t-Date.now();e.current=r<=R?setTimeout(s,r):setTimeout((function(){return O(e,s,t)}),R)}function B(){var e=(0,N.Z)(),s=(0,i.useRef)();return(0,S.Z)((function(){return clearTimeout(s.current)})),(0,i.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(r,a){void 0===a&&(a=0),e()&&(t(),a<=R?s.current=setTimeout(r,a):O(s,r,Date.now()+a))},clear:t}}),[])}var A,H=t(4942),W=t(5090),E=t(2709),z=t(184),q=(A={},(0,H.Z)(A,W.d0,"showing"),(0,H.Z)(A,W.Ix,"showing show"),A),G=i.forwardRef((function(e,s){return(0,z.jsx)(E.Z,(0,F.Z)((0,F.Z)({},e),{},{ref:s,transitionClasses:q}))}));G.displayName="ToastFade";var V=G,$=t(9007),J=t(162),Y=t(473),K=i.createContext({onClose:function(){}}),Q=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],X=i.forwardRef((function(e,s){var t=e.bsPrefix,r=e.closeLabel,a=e.closeVariant,o=e.closeButton,n=e.className,l=e.children,d=(0,Z.Z)(e,Q);t=(0,J.vE)(t,"toast-header");var u=(0,i.useContext)(K),c=(0,$.Z)((function(e){null==u||null==u.onClose||u.onClose(e)}));return(0,z.jsxs)("div",(0,F.Z)((0,F.Z)({ref:s},d),{},{className:b()(t,n),children:[l,o&&(0,z.jsx)(Y.Z,{"aria-label":r,variant:a,onClick:c,"data-dismiss":"toast"})]}))}));X.displayName="ToastHeader",X.defaultProps={closeLabel:"Close",closeButton:!0};var ee=X,se=(0,t(6543).Z)("toast-body"),te=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],re=i.forwardRef((function(e,s){var t=e.bsPrefix,r=e.className,a=e.transition,o=void 0===a?V:a,n=e.show,l=void 0===n||n,d=e.animation,u=void 0===d||d,c=e.delay,g=void 0===c?5e3:c,p=e.autohide,m=void 0!==p&&p,h=e.onClose,f=e.bg,v=(0,Z.Z)(e,te);t=(0,J.vE)(t,"toast");var y=(0,i.useRef)(g),C=(0,i.useRef)(h);(0,i.useEffect)((function(){y.current=g,C.current=h}),[g,h]);var x=B(),I=!(!m||!l),M=(0,i.useCallback)((function(){I&&(null==C.current||C.current())}),[I]);(0,i.useEffect)((function(){x.set(M,y.current)}),[x,M]);var P=(0,i.useMemo)((function(){return{onClose:h}}),[h]),T=!(!o||!u),_=(0,z.jsx)("div",(0,F.Z)((0,F.Z)({},v),{},{ref:s,className:b()(t,r,f&&"bg-".concat(f),!T&&(l?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,z.jsx)(K.Provider,{value:P,children:T&&o?(0,z.jsx)(o,{in:l,unmountOnExit:!0,children:_}):_})}));re.displayName="Toast";var ae=Object.assign(re,{Body:se,Header:ee}),oe=function(e){var s=e.message,t=e.myId,r=e.userId,a=e.Date,o=e.MessageId,n=e.deleteMessage;return(0,z.jsx)("div",{children:(0,z.jsx)("div",{className:"".concat(P," ").concat(t===r?T:_),children:(0,z.jsx)(ae,{className:t===r?j:L,children:(0,z.jsx)(ae.Body,{children:(0,z.jsxs)("div",{className:"d-flex d-inline-block",children:[" ",(0,z.jsxs)("big",{children:[s," "]}),(0,z.jsxs)("div",{className:k,children:[("0"+a.Hour).substr(-2),":",("0"+a.Minutes).substr(-2)]}),(0,z.jsx)("div",{className:U})," ",(0,z.jsx)(Y.Z,{className:D,onClick:function(){n(o)}})]})})})})})},ne=function(e){var s=e.messages2,t=e.myId,r=e.deleteMessage;return(0,z.jsx)("div",{children:null!==s&&s.map((function(e){return(0,z.jsx)(oe,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:r},e.id+e.message)}))})},ie=t(5705),le=t(1724),de=t(6670),ue=t(3360),ce=t(2592);var ge=t.p+"static/media/send-svg2.12d8e771d6d27bcd4485de69966afd04.svg",pe="MessagesFormik_sendSwg__bjMJ-",me={newMessage:""},he=le.Ry({}),fe=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,z.jsx)(z.Fragment,{children:(0,z.jsx)(ie.J9,{initialValues:me,validationSchema:he,onSubmit:function(e,t){var r=t.resetForm;s(e.newMessage),r()},children:function(e){e.handleReset;var s=e.values;return(0,z.jsx)(ie.l0,{children:(0,z.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,z.jsx)("div",{className:"col-9",children:(0,z.jsx)(de.rZ,{label:"",autoFocus:!0,name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",leftLabelLength:""})}),(0,z.jsx)("div",{children:(0,z.jsx)(ue.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,z.jsx)(ce.Z,{src:ge,className:pe,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},ve=t(1087),ye=t(5732),Ce=t(4199),xe=t(6159),Ie=t(1394),Me=function(e){(0,o.Z)(t,e);var s=(0,n.Z)(t);function t(e){var a;return(0,r.Z)(this,t),(a=s.call(this,e)).onChangeTermFunction=function(e){a.setState({onChangeTerm:e.currentTarget.value})},a.onChangeRangeLocal=function(e){a.setState({currentRangeLocal:a.state.currentRangeLocal+e})},a.SetTermFunction=function(){a.props.setTerm(a.state.onChangeTerm)},a.onPageChanged=function(e){var s=a.props,t=s.setCurrentPage,r=s.getUsersThunkCreator,o=s.pageSize,n=s.term,i=s.onlyFriends;t(e),r(e,o,n,i,0)},a.followAPI=function(e){a.props.followThunkCreator(e,a.props.currentPage,a.props.pageSize,a.props.term,a.props.onlyFriends)},a.unfollowAPI=function(e){a.props.unfollowThunkCreator(e,a.props.currentPage,a.props.pageSize,a.props.term,a.props.onlyFriends)},a.state={onChangeTerm:a.props.term,currentRangeLocal:1},a}return(0,a.Z)(t,[{key:"componentDidMount",value:function(){var e=this.props;(0,e.getUsersThunkCreator)(e.currentPage,e.pageSize,e.term,e.onlyFriends,0)}},{key:"componentDidUpdate",value:function(e,s){if(e.term!==this.props.term||e.onlyFriends!==this.props.onlyFriends){this.props.setCurrentPage(1),this.setState({currentRangeLocal:1});var t=this.props;(0,t.getUsersThunkCreator)(1,t.pageSize,t.term,t.onlyFriends,0)}}},{key:"render",value:function(){var e=this.props,s=e.isFetching,t=e.totalUsersCount,r=e.pageSize,a=e.currentPage,o=e.users,n=e.followingInProgress,i=e.isAuth;return(0,z.jsxs)(z.Fragment,{children:[" ",s&&(0,z.jsx)(xe.Z,{}),(0,z.jsx)(Ce.Z,{onPageChanged:this.onPageChanged,totalUsersCount:t,pageSize:r,currentPage:a,users:o,unfollowAPI:this.unfollowAPI,followAPI:this.followAPI,followingInProgress:n,isAuth:i,SetTermFunction:this.SetTermFunction,onChangeTerm:this.state.onChangeTerm,onChangeTermFunction:this.onChangeTermFunction,currentRangeLocal:this.state.currentRangeLocal,onChangeRangeLocal:this.onChangeRangeLocal,setOnlyFriends:this.props.setOnlyFriends,onlyFriends:this.props.onlyFriends,patch:this.props.patch,PageWidth:this.props.PageWidth})]})}}]),t}(i.Component),Pe=(0,d.$j)((function(e){return{users:(0,Ie.x)(e),pageSize:Ie.O.getPageSize(e),totalUsersCount:Ie.O.getTotalUsersCount(e),currentPage:Ie.O.getCurrentPage(e),isFetching:Ie.O.getIsFetching(e),followingInProgress:Ie.O.getFollowingInProgress(e),isAuth:Ie.O.getIsAuth(e),term:e.usersPage.term,myId:e.auth.myId,onlyFriends:Ie.O.getOnlyFriends(e),patch:e.app.patch,PageWidth:e.app.PageWidth}}),{setCurrentPage:ye.D4,getUsersThunkCreator:ye.Uk,followThunkCreator:ye.AC,unfollowThunkCreator:ye.Ow,setTerm:ye.nS,setOnlyFriends:ye.F3})(Me),Te=function(e){var s=e.messages2,t=e.myId,r=e.deleteMessage,a=e.sendMessage,o=e.scrollBottom,n=e.profile,i=e.patch,l=e.PageWidth,d=(0,z.jsx)("div",{children:n&&(0,z.jsxs)(ve.OL,{to:"/profile/".concat(n.userId),className:I,children:[(0,z.jsx)(ce.Z,{src:n.photos.small?n.photos.small:M,className:v,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,z.jsx)("span",{children:n.fullName})]})}),u="dialogs"===i&&l<620;return(0,z.jsxs)("div",{className:"".concat(g," ").concat(u?m:p),children:[!u&&(0,z.jsx)("div",{className:h,children:(0,z.jsx)(Pe,{})})," ",(0,z.jsxs)("div",{className:f,children:[(0,z.jsx)("div",{className:y,children:d}),(0,z.jsxs)("div",{className:C,children:[(0,z.jsx)(ne,{messages2:s,myId:t,deleteMessage:r}),(0,z.jsx)("div",{className:x,children:(0,z.jsx)(fe,{sendMessage:a,scrollBottom:o})})]})]})]})},_e=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},je=function(e){(0,o.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,r.Z)(this,t);for(var a=arguments.length,o=new Array(a),n=0;n<a;n++)o[n]=arguments[n];return(e=s.call.apply(s,[this].concat(o))).sendMessage=function(s){if(e.props.userId){if(s){var t=e.props.profile?e.props.profile.fullName:"",r=e.props.profile?e.props.profile.photos.small:"",a=e.props.myProfile?e.props.myProfile.photos.small:"";e.props.sendDialogsThunkCreator(s,e.props.myId,e.props.myLogin,a,e.props.userId),e.props.updateDialogListThunkCreator(e.props.myId,e.props.userId,t,r)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){_e()},e}return(0,a.Z)(t,[{key:"render",value:function(){return(0,z.jsx)("div",{children:(0,z.jsx)(Te,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profile:this.props.profile,patch:this.props.patch,PageWidth:this.props.PageWidth})})}}]),t}(i.Component),Le=(0,u.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,myLogin:e.auth.myLogin,myProfile:e.auth.myProfile,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profile:e.profilePage.profile,profilePage:e.profilePage,patch:e.app.patch,PageWidth:e.app.PageWidth}}),{sendDialogsThunkCreator:l.nB,deleteMessageThunkCreator:l.EF,updateDialogListThunkCreator:l.wB}),c.Z)(je),ke=function(e){var s=e.getDialogList,t=e.getDialogLastUpdateTime;return(0,i.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,z.jsx)(Le,{})},De=t(81),Ue=t(3990),Fe=function(e){(0,o.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,r.Z)(this,t);for(var a=arguments.length,o=new Array(a),n=0;n<a;n++)o[n]=arguments[n];return(e=s.call.apply(s,[this].concat(o))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2&&e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(0))},e.getDialogs=function(){0!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){0!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,a.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,z.jsx)("div",{children:(0,z.jsx)(ke,{getDialogLastUpdateTime:this.getDialogLastUpdateTime,getDialogList:this.getDialogList})})}}]),t}(i.Component),Ze=(0,u.qC)((0,d.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime}}),{getDialogsThunkCreator:l.kp,setdialogUserID:l.Pg,setMessages:l.Z,getDialogLastUpdateTimeTnkCrt:l.kB,getProfileThunkCreator:De.aI,getMyDialogListThunkCreator:l.l,deleteDialogThunkCreator:l.LZ}),c.Z,Ue.Z)(Fe)}}]);
//# sourceMappingURL=379.efc237ca.chunk.js.map