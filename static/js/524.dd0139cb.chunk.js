"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[524],{8524:function(e,s,t){t.r(s),t.d(s,{default:function(){return Me}});var a=t(1413),o=t(5671),r=t(3144),i=t(136),n=t(7277),l=t(2791),d=t(8281),u=t(8687),c=t(7781),g=t(1852),p="DialogList_BgStyle__bQObV",m="DialogList_photoFixed__u4+AK",h="DialogList_inputFixed__qlqSC",f="DialogList_userPhoto__Gv9DW",v="DialogList_myLink__5+Icu",I=t(6110),x="Message_messagesCommon__WS2pF",y="Message_messageMyId__+mbtn",D="Message_messageNotMyId__5+CvR",M="Message_insideToastMy__P6sDI",j="Message_insideToastNotMy__meNqg",_="Message_time__4GQ5r",C="Message_closeButton__OGOB3",Z=t(5987),T=t(1694),k=t.n(T),L=t(5746),P=t(1683),b=Math.pow(2,31)-1;function N(e,s,t){var a=t-Date.now();e.current=a<=b?setTimeout(s,a):setTimeout((function(){return N(e,s,t)}),b)}function U(){var e=(0,L.Z)(),s=(0,l.useRef)();return(0,P.Z)((function(){return clearTimeout(s.current)})),(0,l.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(a,o){void 0===o&&(o=0),e()&&(t(),o<=b?s.current=setTimeout(a,o):N(s,a,Date.now()+o))},clear:t}}),[])}var w,B=t(4942),E=t(5090),H=t(2709),R=t(184),F=(w={},(0,B.Z)(w,E.d0,"showing"),(0,B.Z)(w,E.Ix,"showing show"),w),O=l.forwardRef((function(e,s){return(0,R.jsx)(H.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:s,transitionClasses:F}))}));O.displayName="ToastFade";var S=O,q=t(9007),A=t(162),V=t(473),G=l.createContext({onClose:function(){}}),J=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],Q=l.forwardRef((function(e,s){var t=e.bsPrefix,o=e.closeLabel,r=e.closeVariant,i=e.closeButton,n=e.className,d=e.children,u=(0,Z.Z)(e,J);t=(0,A.vE)(t,"toast-header");var c=(0,l.useContext)(G),g=(0,q.Z)((function(e){null==c||null==c.onClose||c.onClose(e)}));return(0,R.jsxs)("div",(0,a.Z)((0,a.Z)({ref:s},u),{},{className:k()(t,n),children:[d,i&&(0,R.jsx)(V.Z,{"aria-label":o,variant:r,onClick:g,"data-dismiss":"toast"})]}))}));Q.displayName="ToastHeader",Q.defaultProps={closeLabel:"Close",closeButton:!0};var W=Q,$=(0,t(6543).Z)("toast-body"),K=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],z=l.forwardRef((function(e,s){var t=e.bsPrefix,o=e.className,r=e.transition,i=void 0===r?S:r,n=e.show,d=void 0===n||n,u=e.animation,c=void 0===u||u,g=e.delay,p=void 0===g?5e3:g,m=e.autohide,h=void 0!==m&&m,f=e.onClose,v=e.bg,I=(0,Z.Z)(e,K);t=(0,A.vE)(t,"toast");var x=(0,l.useRef)(p),y=(0,l.useRef)(f);(0,l.useEffect)((function(){x.current=p,y.current=f}),[p,f]);var D=U(),M=!(!h||!d),j=(0,l.useCallback)((function(){M&&(null==y.current||y.current())}),[M]);(0,l.useEffect)((function(){D.set(j,x.current)}),[D,j]);var _=(0,l.useMemo)((function(){return{onClose:f}}),[f]),C=!(!i||!c),T=(0,R.jsx)("div",(0,a.Z)((0,a.Z)({},I),{},{ref:s,className:k()(t,o,v&&"bg-".concat(v),!C&&(d?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,R.jsx)(G.Provider,{value:_,children:C&&i?(0,R.jsx)(i,{in:d,unmountOnExit:!0,children:T}):T})}));z.displayName="Toast";var X=Object.assign(z,{Body:$,Header:W}),Y=function(e){var s=e.message,t=e.myId,a=e.userId,o=e.Date,r=e.MessageId,i=e.deleteMessage;return(0,R.jsx)("div",{children:(0,R.jsx)("div",{className:"".concat(x," ").concat(t===a?y:D),children:(0,R.jsx)(X,{className:t===a?M:j,children:(0,R.jsx)(X.Body,{children:(0,R.jsxs)("div",{className:"d-flex d-inline-block",children:[(0,R.jsxs)("big",{children:[s," "]}),(0,R.jsxs)("div",{className:_,children:[o.Hour,":",o.Minutes]}),(0,R.jsx)(V.Z,{className:C,onClick:function(){i(r)}})]})})})})})},ee=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage;return s.map((function(e){return(0,R.jsx)(Y,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:a},e.id+e.message)}))},se=t(5705),te=t(1724),ae=t(6670),oe=t(3360),re=t(2592);var ie=t.p+"static/media/send-svg2.12d8e771d6d27bcd4485de69966afd04.svg",ne="Dialog_sendSwg__38Jvm",le={newMessage:""},de=te.Ry({}),ue=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(se.J9,{initialValues:le,validationSchema:de,onSubmit:function(e,t){var a=t.resetForm;s(e.newMessage),a()},children:function(e){e.handleReset;var s=e.values;return(0,R.jsx)(se.l0,{children:(0,R.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,R.jsx)("div",{className:"col-9",children:(0,R.jsx)(ae.rZ,{label:"",name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})}),(0,R.jsx)("div",{children:(0,R.jsx)(oe.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,R.jsx)(re.Z,{src:ie,className:ne,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},ce=t(9743),ge=t(1087),pe=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage,o=e.sendMessage,r=e.scrollBottom,i=e.profilePage,n=(0,R.jsx)("div",{className:m,children:i.profile&&(0,R.jsxs)(ge.OL,{to:"/profile/".concat(i.profile.userId),className:v,children:[(0,R.jsx)(re.Z,{src:i.profile.photos.small?i.profile.photos.small:I,className:f,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,R.jsx)("span",{children:i.profile.fullName})]})});return(0,R.jsxs)("div",{className:p,children:[(0,R.jsx)(ce.Z,{children:(0,R.jsx)(ee,{messages2:s,myId:t,deleteMessage:a})}),n,(0,R.jsxs)("div",{className:h,children:[" ",(0,R.jsxs)("div",{children:[(0,R.jsx)(ue,{sendMessage:o,scrollBottom:r})," "]})]})]})},me=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},he=function(e){(0,i.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,o.Z)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).sendMessage=function(s){if(e.props.userId){if(s){var t=0,a=0;null!==e.props.profilePage&&(t=e.props.profilePage.profile.fullName,a=e.props.profilePage.profile.photos.small),e.props.sendDialogsThunkCreator(s,e.props.auth.myId,e.props.auth.myLogin,e.props.auth.myProfile.photos.small,e.props.userId),e.props.updateDialogListThunkCreator(e.props.auth.myId,e.props.userId,t,a)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){return me()},e}return(0,r.Z)(t,[{key:"render",value:function(){return(0,R.jsx)("div",{children:(0,R.jsx)(pe,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profilePage:this.props.profilePage})})}}]),t}(l.Component),fe=(0,c.qC)((0,u.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profilePage:e.profilePage,auth:e.auth}}),{sendDialogsThunkCreator:d.nB,deleteMessageThunkCreator:d.EF,updateDialogListThunkCreator:d.wB}),g.Z)(he),ve=t(2677),Ie=function(e){e.deleteDialog,e.dialogUserID;var s=e.getDialogList,t=(e.dialogs2,e.getDialogLastUpdateTime);return(0,l.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,R.jsx)(ce.Z,{children:(0,R.jsxs)(ve.Z,{children:[(0,R.jsx)(fe,{})," "]})})},xe=t(81),ye=t(3990),De=function(e){(0,i.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,o.Z)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(null))},e.getDialogs=function(){""!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){""!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,r.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e,s,t){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,R.jsx)("div",{children:(0,R.jsx)(Ie,(0,a.Z)((0,a.Z)({messages2:this.props.messages2,dialogs:this.props.dialogs,dialogs2:this.props.dialogs2},this.props),{},{getDialogs:this.getDialogs,getDialogLastUpdateTime:this.getDialogLastUpdateTime,myId:this.props.myId,getDialogList:this.getDialogList,dialogUserID:this.props.dialogUserID,deleteDialog:this.deleteDialog}))})}}]),t}(l.Component),Me=(0,c.qC)((0,u.$j)((function(e){return{isAuth:e.auth.isAuth,myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime,dialogs2:e.dialogsPage.dialogs2,profilePage:e.profilePage,auth:e.auth}}),{getDialogsThunkCreator:d.kp,setdialogUserID:d.Pg,setMessages:d.Z,getDialogLastUpdateTimeTnkCrt:d.kB,getProfileThunkCreator:xe.aI,getMyDialogListThunkCreator:d.l,deleteDialogThunkCreator:d.LZ}),g.Z,ye.Z)(De)}}]);
//# sourceMappingURL=524.dd0139cb.chunk.js.map