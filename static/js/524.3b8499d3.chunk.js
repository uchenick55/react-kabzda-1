"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[524],{8524:function(e,s,t){t.r(s),t.d(s,{default:function(){return je}});var a=t(1413),o=t(5671),r=t(3144),i=t(136),n=t(7277),l=t(2791),d=t(2807),u=t(8687),c=t(7781),g=t(1852),p="DialogList_BgStyle__2iEaj",m="DialogList_inputFixed__xsJy-",h="DialogList_photoFixed__KaeYd",f="DialogList_userPhoto__0CLsE",v="DialogList_linkNoDecoration__hNHxk",y=t(6110),x="Message_messagesCommon__y3ALJ",I="Message_messageMyId__2lyA3",D="Message_messageNotMyId__wlQ5a",j="Message_insideToastMy__uNjRB",M="Message_insideToastNotMy__Z0gRy",_="Message_time__A+UPN",Z="Message_closeButton__YmmdJ",C=t(5987),T=t(1694),k=t.n(T),L=t(5746),N=t(1683),P=Math.pow(2,31)-1;function b(e,s,t){var a=t-Date.now();e.current=a<=P?setTimeout(s,a):setTimeout((function(){return b(e,s,t)}),P)}function w(){var e=(0,L.Z)(),s=(0,l.useRef)();return(0,N.Z)((function(){return clearTimeout(s.current)})),(0,l.useMemo)((function(){var t=function(){return clearTimeout(s.current)};return{set:function(a,o){void 0===o&&(o=0),e()&&(t(),o<=P?s.current=setTimeout(a,o):b(s,a,Date.now()+o))},clear:t}}),[])}var U,B=t(4942),E=t(5090),H=t(2709),R=t(184),A=(U={},(0,B.Z)(U,E.d0,"showing"),(0,B.Z)(U,E.Ix,"showing show"),U),F=l.forwardRef((function(e,s){return(0,R.jsx)(H.Z,(0,a.Z)((0,a.Z)({},e),{},{ref:s,transitionClasses:A}))}));F.displayName="ToastFade";var J=F,S=t(9007),O=t(162),V=t(473),q=l.createContext({onClose:function(){}}),W=["bsPrefix","closeLabel","closeVariant","closeButton","className","children"],Y=l.forwardRef((function(e,s){var t=e.bsPrefix,o=e.closeLabel,r=e.closeVariant,i=e.closeButton,n=e.className,d=e.children,u=(0,C.Z)(e,W);t=(0,O.vE)(t,"toast-header");var c=(0,l.useContext)(q),g=(0,S.Z)((function(e){null==c||null==c.onClose||c.onClose(e)}));return(0,R.jsxs)("div",(0,a.Z)((0,a.Z)({ref:s},u),{},{className:k()(t,n),children:[d,i&&(0,R.jsx)(V.Z,{"aria-label":o,variant:r,onClick:g,"data-dismiss":"toast"})]}))}));Y.displayName="ToastHeader",Y.defaultProps={closeLabel:"Close",closeButton:!0};var $=Y,K=(0,t(6543).Z)("toast-body"),Q=["bsPrefix","className","transition","show","animation","delay","autohide","onClose","bg"],z=l.forwardRef((function(e,s){var t=e.bsPrefix,o=e.className,r=e.transition,i=void 0===r?J:r,n=e.show,d=void 0===n||n,u=e.animation,c=void 0===u||u,g=e.delay,p=void 0===g?5e3:g,m=e.autohide,h=void 0!==m&&m,f=e.onClose,v=e.bg,y=(0,C.Z)(e,Q);t=(0,O.vE)(t,"toast");var x=(0,l.useRef)(p),I=(0,l.useRef)(f);(0,l.useEffect)((function(){x.current=p,I.current=f}),[p,f]);var D=w(),j=!(!h||!d),M=(0,l.useCallback)((function(){j&&(null==I.current||I.current())}),[j]);(0,l.useEffect)((function(){D.set(M,x.current)}),[D,M]);var _=(0,l.useMemo)((function(){return{onClose:f}}),[f]),Z=!(!i||!c),T=(0,R.jsx)("div",(0,a.Z)((0,a.Z)({},y),{},{ref:s,className:k()(t,o,v&&"bg-".concat(v),!Z&&(d?"show":"hide")),role:"alert","aria-live":"assertive","aria-atomic":"true"}));return(0,R.jsx)(q.Provider,{value:_,children:Z&&i?(0,R.jsx)(i,{in:d,unmountOnExit:!0,children:T}):T})}));z.displayName="Toast";var G=Object.assign(z,{Body:K,Header:$}),X=function(e){var s=e.message,t=e.myId,a=e.userId,o=e.Date,r=e.MessageId,i=e.deleteMessage;return(0,R.jsxs)("div",{children:[" ",(0,R.jsx)("div",{className:"".concat(x," ").concat(t===a?I:D),children:(0,R.jsx)(G,{className:t===a?j:M,children:(0,R.jsx)(G.Body,{children:(0,R.jsxs)("div",{className:"d-flex d-inline-block",children:[(0,R.jsxs)("big",{children:[s," "]}),(0,R.jsxs)("div",{className:_,children:[o.Hour,":",o.Minutes]}),(0,R.jsx)(V.Z,{className:Z,onClick:function(){i(r)}})]})})})})]})},ee=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage;return s.map((function(e){return(0,R.jsx)(X,{message:e.message,myId:t,userId:e.userId,Date:e.Date,MessageId:e.id,deleteMessage:a},e.id+e.message)}))},se=t(2506),te=t(1724),ae=t(6670),oe=t(3360),re=t(2592);var ie=t.p+"static/media/send-svg2.bf250e69b5830be8d34d1dd3f2cbf9ac.svg",ne="Dialog_sendSwg__vWWca",le={newMessage:""},de=te.Ry({}),ue=function(e){var s=e.sendMessage,t=e.scrollBottom;return(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(se.J9,{initialValues:le,validationSchema:de,onSubmit:function(e,t){var a=t.resetForm;s(e.newMessage),a()},children:function(e){e.handleReset;var s=e.values;return(0,R.jsx)(se.l0,{children:(0,R.jsxs)("div",{className:"d-flex d-inline-block justify-content-center align-items-center",children:[(0,R.jsx)("div",{className:"col-9",children:(0,R.jsx)(ae.rZ,{label:"",name:"newMessage",type:"text",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})}),(0,R.jsx)("div",{children:(0,R.jsx)(oe.Z,{variant:"light",className:"mx-2",type:"submit",onClick:t,disabled:!s.newMessage,children:(0,R.jsx)(re.Z,{src:ie,className:ne,alt:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",title:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"})})})]})})}})})},ce=t(9743),ge=t(1087),pe=function(e){var s=e.messages2,t=e.myId,a=e.deleteMessage,o=e.sendMessage,r=e.scrollBottom,i=e.profilePage,n=(0,R.jsx)("div",{className:h,children:i.profile&&(0,R.jsxs)(ge.OL,{to:"/profile/".concat(i.profile.userId),children:[" ",(0,R.jsx)(re.Z,{src:i.profile.photos.small?i.profile.photos.small:y,className:f,title:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c",alt:"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0440\u043e\u0444\u0438\u043b\u044c"}),(0,R.jsx)("span",{className:v,children:i.profile.fullName})]})});return(0,R.jsxs)("div",{className:p,children:[(0,R.jsx)(ce.Z,{children:(0,R.jsx)(ee,{messages2:s,myId:t,deleteMessage:a})}),n,(0,R.jsxs)("div",{className:m,children:[" ",(0,R.jsxs)("div",{children:[(0,R.jsx)(ue,{sendMessage:o,scrollBottom:r})," "]})]})]})},me=function(){var e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight);window.scrollTo(0,e)},he=function(e){(0,i.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,o.Z)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).sendMessage=function(s){if(e.props.userId){if(s){var t=0,a=0;null!==e.props.profilePage&&(t=e.props.profilePage.profile.fullName,a=e.props.profilePage.profile.photos.small),e.props.sendDialogsThunkCreator(s,e.props.auth.myId,e.props.auth.myLogin,e.props.auth.myProfile.photos.small,e.props.userId),e.props.updateDialogListThunkCreator(e.props.auth.myId,e.props.userId,t,a)}}else alert("\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043b\u043e\u0433")},e.deleteMessage=function(s){e.props.deleteMessageThunkCreator(s,e.props.myId,e.props.userId)},e.scrollBottom=function(){return me()},e}return(0,r.Z)(t,[{key:"render",value:function(){return(0,R.jsx)("div",{children:(0,R.jsx)(pe,{messages2:this.props.messages2,myId:this.props.myId,deleteMessage:this.deleteMessage,sendMessage:this.sendMessage,scrollBottom:this.scrollBottom,profilePage:this.props.profilePage})})}}]),t}(l.Component),fe=(0,c.qC)((0,u.$j)((function(e){return{myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,profilePage:e.profilePage,auth:e.auth}}),{sendDialogsThunkCreator:d.nB,deleteMessageThunkCreator:d.EF,updateDialogListThunkCreator:d.wB}),g.Z)(he),ve=t(2677),ye=function(e){e.deleteDialog,e.dialogUserID;var s=e.getDialogList,t=(e.dialogs2,e.getDialogLastUpdateTime);return(0,l.useEffect)((function(){var e=setInterval((function(){t(),s()}),1e3);return function(){clearInterval(e)}}),[t,s]),(0,R.jsx)(ce.Z,{children:(0,R.jsxs)(ve.Z,{children:[(0,R.jsx)(fe,{})," "]})})},xe=t(8859),Ie=t(3990),De=function(e){(0,i.Z)(t,e);var s=(0,n.Z)(t);function t(){var e;(0,o.Z)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=s.call.apply(s,[this].concat(r))).commonPartMountUpdate=function(){e.props.userId?e.props.dialogUserID!==e.props.userId&&(e.props.setdialogUserID(e.props.userId),e.props.getProfileThunkCreator(e.props.userId,!0,e.props.myId)):e.props.messages2.length>0&&(e.props.setMessages([]),e.props.setdialogUserID(null))},e.getDialogs=function(){""!==e.props.userId&&e.props.getDialogsThunkCreator(e.props.myId,e.props.userId)},e.getDialogLastUpdateTime=function(){""!==e.props.userId&&e.props.getDialogLastUpdateTimeTnkCrt(e.props.myId,e.props.userId)},e.getDialogList=function(){e.props.getMyDialogListThunkCreator(e.props.myId)},e.deleteDialog=function(s,t){e.props.deleteDialogThunkCreator(s,e.props.myId,t)},e}return(0,r.Z)(t,[{key:"componentDidMount",value:function(){this.getDialogList(),this.commonPartMountUpdate()}},{key:"componentDidUpdate",value:function(e,s,t){this.commonPartMountUpdate(),this.props.dialogLastUpdateTime!==e.dialogLastUpdateTime&&this.getDialogs()}},{key:"render",value:function(){return(0,R.jsx)("div",{children:(0,R.jsx)(ye,(0,a.Z)((0,a.Z)({messages2:this.props.messages2,dialogs:this.props.dialogs,dialogs2:this.props.dialogs2},this.props),{},{getDialogs:this.getDialogs,getDialogLastUpdateTime:this.getDialogLastUpdateTime,myId:this.props.myId,getDialogList:this.getDialogList,dialogUserID:this.props.dialogUserID,deleteDialog:this.deleteDialog}))})}}]),t}(l.Component),je=(0,c.qC)((0,u.$j)((function(e){return{isAuth:e.auth.isAuth,myId:e.auth.myId,dialogUserID:e.dialogsPage.dialogUserID,messages2:e.dialogsPage.messages2,dialogLastUpdateTime:e.dialogsPage.dialogLastUpdateTime,dialogs2:e.dialogsPage.dialogs2,profilePage:e.profilePage,auth:e.auth}}),{getDialogsThunkCreator:d.kp,setdialogUserID:d.Pg,setMessages:d.Z,getDialogLastUpdateTimeTnkCrt:d.kB,getProfileThunkCreator:xe.aI,getFollowThunkCreator:d.fB,getMyDialogListThunkCreator:d.l,deleteDialogThunkCreator:d.LZ}),g.Z,Ie.Z)(De)}}]);
//# sourceMappingURL=524.3b8499d3.chunk.js.map